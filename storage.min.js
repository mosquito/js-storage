(function(h){var k=window.md5||function(f){var e=0,g,b,a;if(0==f.length)return e;g=0;for(a=f.length;g<a;g++)b=f.charCodeAt(g),e=(e<<5)-e+b,e|=0;return e},f={};h.JSONStore=function(h){function e(a,d){b.cl.map(function(c){c.k===a&&c.cb(a,d);c.k||c.cb(a,d)})}function g(a,d){b.dl.map(function(c){c.k===a&&c.cb(a,d)})}var b=this;b.prefix=h||"JSONStore-";b.prefixExp=new RegExp("^"+b.prefix+"@.*$");b.storage=window.localStorage;b.toHashKey=function(a){return b.prefix+"@"+k(JSON.stringify(a))};b.cl=[];b.dl=
[];b.pub={on:function(a,d,c){if("change"==a)return b.cl.push({k:d,cb:c});if("delete"==a)return b.dl.push({k:d,cb:c})},set:function(a,d){var c=b.toHashKey(a);f[c]=d;b.storage[c]=JSON.stringify(d);e(a,d);return d},exists:function(a){return b.toHashKey(a)in b.storage},get:function(a,d){var c=b.toHashKey(a);if(!(c in f))if(c in b.storage&&"undefined"!=b.storage[c]){var l=JSON.parse(b.storage[c]);f[c]=l}else f[c]=d;return f[c]},append:function(a,d){var c=this.get(a,[]);return c instanceof Array?(c.push(d),
this.set(a,c),e(a,c),c):!1},appendUnique:function(a,d){return this.some(a,d)?(e(a,d),this.get(a,d)):this.append(a,d)},popItems:function(a,d){var c=[],b=[];this.get(a,[]).map(function(a){a!=d?c.push(a):b.push(a)});this.set(a,c);return b},pop:function(a){var d=this.get(a);this.remove(a);return d},setValue:function(a,d,c){var b=this.get(a,{});if(b instanceof Array)return!1;b[d]=c;this.set(a,b);return b},extendValue:function(a,d,c){var b=this.get(a,{});if(!(b instanceof Array)&&b instanceof Object){for(var e in c)d in
b||(b[d]={}),b[d][e]=c[e];this.set(a,b);return b}},some:function(a,b){return this.get(a,[]).some(function(a,e,f){if(a==b)return!0})},popValue:function(a,b){var c=this.get(a,{});if(!(c instanceof Array)){var e=c[b];delete c[b];this.set(a,c);return e}},remove:function(a){var d=b.toHashKey(a);if(d in b.storage){var c=this.get(d);b.storage.removeItem(d);g(a,c);return c}return!1},flush:function(){for(var a in b.storage)b.prefixExp.test(a)&&b.storage.removeItem(a);return!0}};return b.pub}})(this);